import { makeCtx } from "../../common/runtime.js";export async function handle(input:any){ const ctx=await makeCtx("esa_runtime"); if(input?.action==='metrics'){ const { supabase }=ctx; const [{ data: jAll }, { data: jOk }, { data: runs }]=await Promise.all([ supabase.from("jobs").select("id"), supabase.from("jobs").select("id").eq("status","ok"), supabase.from("agent_runs").select("id") ]); return { status:"ok", data:{ jobs_total: jAll?.length||0, jobs_ok: jOk?.length||0, runs_total: runs?.length||0 } }; } return { status:"ok" }; }