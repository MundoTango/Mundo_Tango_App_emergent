import { makeCtx } from "../../common/runtime.js";
import { handler as parseEvent } from "./subagents/fb_parser_agent/handler.js";
export async function handle(input:any){ const ctx=await makeCtx("facebook_events"); const a=input?.action||"import"; if(a==="import"){ const raw=input?.fb_event_payload||{}; const { supabase }=ctx; await supabase.from("fb_event_imports").insert({ fb_event_id: String(raw.id||Date.now()), payload_raw: raw }); const res=await parseEvent({ fb_event_payload: raw }, ctx); return res; } if(a==="list"){ const { supabase }=await makeCtx("facebook_events:list"); const { data, error }=await supabase.from("events").select("*").order("starts_at",{ascending:false}).limit(100); if(error) return { status:"fail", error:{ code:"db_error", message:error.message } }; return { status:"ok", data }; } return { status:"ok" }; }