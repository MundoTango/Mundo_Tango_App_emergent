import type { AgentHandler } from "../../../../common/agent-types";
export const handler: AgentHandler = async (input, ctx) => { const { supabase, log }=ctx; const p:any=input?.fb_event_payload||{}; const title=p?.name||"FB Event"; const starts_at=p?.start_time||new Date().toISOString(); const ends_at=p?.end_time||null; const fb_event_id=String(p?.id||Math.random()); log("fb_parser:normalize",{fb_event_id,title}); const { data: ev, error: evErr }=await supabase.from("events").insert({ title, starts_at, ends_at, source:"facebook" }).select().single(); if(evErr) return { status:"fail", error:{ code:"insert_event_failed", message: evErr.message }}; await supabase.from("event_links").insert({ event_id: ev.id, source:"facebook", source_id: fb_event_id }); return { status:"ok", data:{ event_id: ev.id, fb_event_id } }; };