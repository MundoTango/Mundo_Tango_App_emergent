import { makeCtx } from "../../common/runtime.js";import { sendEmail } from "../../common/notify.js";
export async function handle(input:any){ const ctx=await makeCtx("organizer_dashboards"); const { supabase }=ctx; if(input?.action==="add_volunteer"){ const { event_id, user_id, role="general" }=input; if(!event_id||!user_id) return { status:"fail", error:{ code:"missing_params" } }; const { data, error }=await supabase.from("volunteers").insert({ event_id, user_id, role, status:"invited" }).select().single(); if(error) return { status:"fail", error:{ code:"db_error", message:error.message } }; await sendEmail(process.env.ADMIN_EMAIL||"test@example.com", "Volunteer Invite", `<p>You have been invited as ${role}</p>`); return { status:"ok", data }; } const [e,v,p]=await Promise.all([ supabase.from("events").select("id"), supabase.from("volunteers").select("id"), supabase.from("predictions").select("id") ]); return { status:"ok", data:{ events_count:e.data?.length||0, volunteers_count:v.data?.length||0, predictions_count:p.data?.length||0 } }; }